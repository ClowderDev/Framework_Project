@model ProductDetailsViewModel
@{
	ViewData["Title"] = "Chi tiết sản phẩm";
	Layout = "~/Views/Shared/_Layout.cshtml";
	var isAuthenticated = User.Identity.IsAuthenticated;
	var userEmail = "";
	if (isAuthenticated)
	{
		userEmail = User.Claims.FirstOrDefault(c => c.Type == System.Security.Claims.ClaimTypes.Email)?.Value
			?? User.Claims.FirstOrDefault(c => c.Type == "email")?.Value;
	}
}

<div class="row">
	<div class="col-sm-3">
		<partial name="_SidebarPartial" />
	</div>

	<div class="col-sm-9 padding-right">
		<div class="product-details">
			<!--product-details-->
			<div class="col-sm-5">
				<div class="view-product">
					<img src="~/media/products/@Model.ProductDetails.Image" alt="" width="100px" height="200px" />
					<h3>ZOOM</h3>
				</div>
				<div id="similar-product" class="carousel slide" data-ride="carousel">

					<!-- Wrapper for slides -->
					<div class="carousel-inner">
						<div class="item">
							<a href=""><img src="images/product-details/similar1.jpg" alt=""></a>
							<a href=""><img src="images/product-details/similar2.jpg" alt=""></a>
							<a href=""><img src="images/product-details/similar3.jpg" alt=""></a>
						</div>
					</div>

					<!-- Controls -->
					<a class="left item-control" href="#similar-product" data-slide="prev">
						<i class="fa fa-angle-left"></i>
					</a>
					<a class="right item-control" href="#similar-product" data-slide="next">
						<i class="fa fa-angle-right"></i>
					</a>
				</div>

			</div>
			<div class="col-sm-7">
				<div class="product-information">
					<!--/product-information-->
					<h2>@Model.ProductDetails.Name</h2>
					<span>
						<span>@Model.ProductDetails.Price.ToString("#,##0 VNĐ")</span>
						<form id="add-to-cart-form" method="post" asp-action="AddQuantity" asp-controller="Cart" style="display:inline;">
							<label for="quantity">Số lượng:</label>
							<input type="number" name="quantity" id="quantity" value="1" min="1" max="@Model.ProductDetails.Quantity" style="width:60px;" />
							<input type="hidden" name="productId" value="@Model.ProductDetails.Id" />
							<button type="submit" class="btn btn-default add-to-cart">
								<i class="fa fa-shopping-cart"></i>Thêm giỏ hàng
							</button>
						</form>
					</span>
					@if(@Model.ProductDetails.Quantity > 0 ){
						<p><b>Tình trạng:</b> Còn hàng</p>
					}
					else{
						<p><b>Tình trạng:</b> Hết hàng</p>
					}
					<p><b>Điều kiện:</b> Mới</p>
					<p><b>Thương hiệu:</b> @Model.ProductDetails.Brand?.Name</p>
					<p><b>Danh mục:</b> @Model.ProductDetails.Category?.Name</p>
					<a href=""><img src="images/product-details/share.png" class="share img-responsive" alt="" /></a>
				</div><!--/product-information-->
			</div>
		</div><!--/product-details-->

		<div class="category-tab shop-details-tab">
			<!--category-tab-->
			<div class="col-sm-12">
				<ul class="nav nav-tabs">
					<li class="active"><a href="#details" data-toggle="tab">Chi tiết</a></li>
					<li><a href="#reviews" data-toggle="tab">Đánh giá (@(Model.ProductDetails.Ratings != null ? Model.ProductDetails.Ratings.Count : 0))</a></li>
				</ul>
			</div>
			<div class="tab-content">
				<div class="tab-pane fade active in" id="details">
					@Html.Raw(Model.ProductDetails.Description)
				</div>

				<div class="tab-pane fade" id="reviews">
					<div class="col-sm-12">
						@if (Model.ProductDetails.Ratings != null && Model.ProductDetails.Ratings.Count > 0)
						{
							foreach (var review in Model.ProductDetails.Ratings)
							{
								<div class="review-item">
									<ul>
										<li><a href=""><i class="fa fa-user"></i>@review.Email</a></li>
										<li><a href=""><i class="fa fa-clock-o"></i>@DateTime.Now.ToString("hh:mm tt")</a></li>
										<li><a href=""><i class="fa fa-calendar-o"></i>@DateTime.Now.ToString("dd MMMM yyyy")</a></li>
									</ul>
									<div class="rating-display">
										@for (int i = 1; i <= 5; i++)
										{
											if (i <= int.Parse(review.Star))
											{
												<span class="star filled">★</span>
											}
											else
											{
												<span class="star">☆</span>
											}
										}
									</div>
									<p>@review.Comment</p>
								</div>
							}
						}
						else
						{
							<p>Chưa có đánh giá nào cho sản phẩm này.</p>
						}
						@if (isAuthenticated)
						{
							<p><b>Viết đánh giá của bạn</b></p>
							<form autocomplete="off" asp-action="CommentProduct" asp-controller="Product" method="POST">
								<span>
									<input asp-for="@Model.ProductDetails.Id" name="ProductId" type="hidden" />
									<input name="Name" type="text" value="@userEmail" readonly />
									<input name="Email" type="hidden" value="@userEmail" />
								</span>
								<textarea asp-for="@Model.Comment"></textarea>
								<span asp-validation-for="@Model.Comment" class="text-danger"></span>

								<b>Rating: </b>
								<div class="rating">
									<input type="radio" name="Star" value="5" id="5"><label for="5">☆</label>
									<input type="radio" name="Star" value="4" id="4"><label for="4">☆</label>
									<input type="radio" name="Star" value="3" id="3"><label for="3">☆</label>
									<input type="radio" name="Star" value="2" id="2"><label for="2">☆</label>
									<input type="radio" name="Star" value="1" id="1"><label for="1">☆</label>
								</div>
								<button type="submit" class="btn btn-default pull-right">
									Gửi
								</button>
							</form>
						}
						else
						{
							<div class="alert alert-warning">Bạn cần <a href="/Account/Login">đăng nhập</a> để đánh giá sản phẩm.</div>
						}
					</div>
				</div>

			</div>
		</div><!--/category-tab-->

		<div class="recommended_items">
			<!--recommended_items-->
			<h2 class="title text-center">Sản phẩm liên quan</h2>

			<div id="recommended-item-carousel" class="carousel slide" data-ride="carousel">
				<div class="carousel-inner">

					<div class="item active">
						@foreach (var relatedProduct in @ViewBag.RelatedProducts as IEnumerable<ProductModel>)
						{
							<div class="col-sm-4">
								<div class="product-image-wrapper">
									<div class="single-products">


										<div class="productinfo text-center">
											<a asp-action="Details" asp-controller="Product" asp-route-Id="@relatedProduct.Id">
												<img src="~/media/products/@relatedProduct.Image" alt="@relatedProduct.Name" width="100px" height="200px" />
												<h2>@relatedProduct.Price.ToString("#,##0 VNĐ")</h2>
												<p>@relatedProduct.Name</p>
												<p>Danh mục: @relatedProduct.Category.Name</p>
												<p>Thương hiệu: @relatedProduct.Brand.Name</p>
											</a>

										</div>


									</div>

								</div>
							</div>
						}

					</div>

				</div>
				<a class="left recommended-item-control" href="#recommended-item-carousel" data-slide="prev">
					<i class="fa fa-angle-left"></i>
				</a>
				<a class="right recommended-item-control" href="#recommended-item-carousel" data-slide="next">
					<i class="fa fa-angle-right"></i>
				</a>
			</div>

		</div><!--/recommended_items-->

	</div>
</div>
@section Scripts {
	@{
		await Html.RenderPartialAsync("_ValidationScriptsPartial");
	}
	<style>
		.rating {
			display: inline-flex;
			flex-direction: row-reverse;
			justify-content: flex-end;
		}
		.rating input {
			display: none;
		}
		.rating label {
			cursor: pointer;
			font-size: 30px;
			color: #ddd;
			padding: 5px;
		}
		.rating input:checked ~ label,
		.rating label:hover,
		.rating label:hover ~ label {
			color: #ffd700;
		}
		.review-item {
			margin-bottom: 30px;
			padding: 20px;
			background: #f9f9f9;
			border-radius: 5px;
		}
		.rating-display {
			margin: 10px 0;
		}
		.rating-display .star {
			font-size: 24px;
			color: #ddd;
		}
		.rating-display .star.filled {
			color: #ffd700;
		}
	</style>
}